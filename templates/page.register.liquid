{%- layout none -%}

{% if customer %}
<script>
window.location.replace("/collections/marcas");
</script>
{% endif %}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta content="IE=edge" http-equiv="X-UA-Compatible" />
    <meta content="width=device-width, initial-scale=1.0" name="viewport" />

    <title>Inventa - Cadastro CNPJ</title>

    <link href="https://fonts.googleapis.com" rel="preconnect" />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Nunito+Sans:ital,wght@0,200;0,300;0,400;0,600;0,700;0,800;0,900;1,200;1,300;1,400;1,600;1,700;1,800;1,900&display=swap"
      rel="stylesheet"
    />

    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js"></script>
    <link rel="stylesheet" href="{{ 'cadastro.css' | asset_url }}" />
    <link rel="stylesheet" href="{{ 'spinner.css' | asset_url }}" />
    <link rel="stylesheet" href="{{ 'input.css' | asset_url }}" />

    <!-- Google Tag Manager -->
    <script>
      (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
        new Date().getTime(),event:'gtm.js',userID:'{{ customer.id }}'});var f=d.getElementsByTagName(s)[0],
        j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
        'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
        })(window,document,'script','dataLayer','{% if shop.name contains 'DEV' %}GTM-MBKM5XD{% else %}GTM-5SKRQ4V{% endif %}');
    </script>
    <!-- End Google Tag Manager -->

    <!-- Rudderstack -->

    <script>
      rudderanalytics = window.rudderanalytics = [];
      var methods = [
        "load",
        "page",
        "track",
        "identify",
        "alias",
        "group",
        "ready",
        "reset",
        "getAnonymousId",
        "setAnonymousId",
        "getUserId",
        "getUserTraits",
        "getGroupId",
        "getGroupTraits",
        "startSession",
        "endSession"
      ];
      for (var i = 0; i < methods.length; i++) {
        var method = methods[i];
        rudderanalytics[method] = (function (methodName) {
          return function () {
            rudderanalytics.push(
              [methodName].concat(Array.prototype.slice.call(arguments))
            );
          };
        })(method);
      }

      rudderanalytics.load(
        "2HKO9K4B5abXiV7q6l6Y68Zmuh6", 
        "https://inventa-dataplane.rudderstack.com");
      rudderanalytics.page();
    </script>

    <script src="https://cdn.rudderlabs.com/v1.1/rudder-analytics.min.js"></script>

    <!-- End Rudderstack -->

    {%- if settings.favicon -%}
    <link rel="shortcut icon" href="{{ settings.favicon | img_url: '96x96' }}" type="image/png">
    {%- endif -%}
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript><iframe src="https://www.googletagmanager.com/ns.html?id={% if shop.name contains 'DEV' %}GTM-MBKM5XD{% else %}z{% endif %}"
    height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
    <!-- End Google Tag Manager (noscript) -->

    <nav class="nav-container">
      <a class="text-center logo" href="/">
        <svg
          height="24"
          id="Inventa_Logo"
          version="1.1"
          viewbox="0 0 2664.6 566.9"
          width="112.77"
          x="0px"
          xml:space="preserve"
          xmlns:xlink="http://www.w3.org/1999/xlink"
          xmlns="http://www.w3.org/2000/svg"
          y="0px"
        >
          <path
            class="st0"
            d="M2652,199.8c-27.3,0-54.7,0-82,0c-6.4,0-11.8,4.8-12.5,11.2c-1.2,10.3-2.4,20.7-3.6,31c-0.1,1.2-1.7,1.5-2.3,0.5c-19.2-33.1-68.9-52.7-112.3-52.7c-87.1,0-182.8,74.1-182.8,188.6c0,113.7,95,187.9,182.8,187.9c40.5,0,92.3-16.2,112.3-52c0.6-1.1,2.2-0.7,2.4,0.5c1.2,10.3,2.4,20.7,3.6,31c0.7,6.4,6.1,11.2,12.5,11.2c27.3,0,54.7,0,82,0c7,0,12.6-5.6,12.6-12.6c0-110.6,0-221.2,0-331.9C2664.6,205.4,2658.9,199.8,2652,199.8z M2460.1,461.8c-46.1,0-83.5-37.4-83.5-83.5c0-46.1,37.4-83.5,83.5-83.5s83.5,37.4,83.5,83.5C2543.6,424.4,2506.2,461.8,2460.1,461.8z M2220,212.4c0,23,0,46.1,0,69.1c0,7-5.6,12.6-12.6,12.6c-32.1,0-64.2,0-96.3,0c-0.7,0-1.3,0.6-1.2,1.3c0,37.7,0,75.5,0,113.2c0,36.7,22.3,59,59,59
              c9.4,0,19.2-1.7,35.1-6.1c8.1-2.3,16,3.8,16,12.1c0,23.7,0,47.5,0,71.3c0,5.1-3,9.6-7.6,11.6c-13.9,6-36.2,10.4-63,10.4
              c-95.8,0-159.1-63.4-159.1-147.6c0-36,0-71.9,0-107.9c0-5.8,0-11.6,0-17.4c0-31.4,0-62.9,0-94.3c0-2.4,0-4.9,0-7.4
              c0-22.6,0-45.2,0-67.8c0-7,5.6-12.6,12.6-12.6c31.4,0,62.9,0,94.3,0c7,0,12.6,5.6,12.6,12.6c0,24.7,0,49.3,0,74
              c0,0.7,0.6,1.3,1.3,1.3c32.1,0,64.2,0,96.3,0C2214.4,199.8,2220,205.4,2220,212.4z M1918.3,358.3c0,62,0,124.1,0,186.1
              c0,7-5.6,12.6-12.6,12.6c-31.4,0-62.9,0-94.3,0c-7,0-12.6-5.6-12.6-12.6c0-58.2,0-116.4,0-174.6c0-39.6-30.9-72.7-70.5-72.7
              c-38.1,0-69.8,33.1-69.8,74.1c0,57.7,0,115.4,0,173.1c0,7-5.6,12.6-12.6,12.6c-31.4,0-62.9,0-94.3,0c-7,0-12.6-5.6-12.6-12.6
              c0-110.7,0-221.3,0-331.9c0-7,5.6-12.6,12.6-12.6c27.3,0,54.5,0,81.8,0c6.1,0,11.4,4.5,12.4,10.6c1.8,10.9,3.5,21.7,5.3,32.6
              c0.2,1.1,1.6,1.5,2.2,0.7c23.9-34.7,65.3-53.8,108.1-53.8C1857.8,189.9,1918.3,263.3,1918.3,358.3z M1281.2,189.8
              c-115.2,0-203,84.9-203,190c0,108,93.6,187.2,204.4,187.2c64.9,0,123-27.2,158.3-67c5.6-6.3,3.5-16.2-4.1-19.8
              c-24-11.2-48-22.4-72-33.6c-5-2.3-11-1.1-14.7,3c-14.9,16.7-40.7,23.7-66,23.7c-44,0-75.4-21.7-87.3-61c-0.2-0.8,0.4-1.6,1.2-1.6
              c90.2,0,180.3,0,270.5,0c7,0,12.8-6,12.5-13.1C1475.7,280.1,1399.9,189.8,1281.2,189.8z M1360.8,340.2c-54.3,0-108.6,0-162.9,0
              c-0.9,0-1.5-0.8-1.2-1.7c11.9-36.4,41.2-56.7,84.4-56.7c37.7,0,68.3,15.4,80.9,56.7C1362.2,339.4,1361.6,340.2,1360.8,340.2z
              M1079.1,218.1C1022.2,328.8,965.4,439.4,908.5,550c-2.2,4.2-6.5,6.8-11.2,6.8c-11.9,0-23.8,0-35.7,0c-4.7,0-9-2.6-11.2-6.8
              c-56.8-110.6-113.7-221.2-170.7-331.9c-2-3.9-1.8-8.6,0.5-12.3c2.3-3.7,6.4-6,10.8-6c33.6,0,67.2,0,100.8,0c5,0,9.5,2.9,11.5,7.4
              c24.9,55,49.8,110,74.7,165c0.5,1,1.8,1,2.1,0c25.1-55,50.3-110,75.4-165c2.1-4.5,6.6-7.4,11.5-7.4c33.6,0,67.2,0,100.8,0
              c4.4,0,8.5,2.3,10.8,6C1080.9,209.5,1081.1,214.2,1079.1,218.1z M662,358.1c0,62,0,124.1,0,186.1c0,7-5.6,12.6-12.6,12.6
              c-31.4,0-62.9,0-94.3,0c-7,0-12.6-5.6-12.6-12.6c0-58.2,0-116.4,0-174.6c0-39.6-31-72.7-70.5-72.7c-38.2,0-69.8,33.1-69.8,74.1
              c0,57.7,0,115.4,0,173.1c0,7-5.6,12.6-12.6,12.6c-31.4,0-62.9,0-94.3,0c-7,0-12.6-5.6-12.6-12.6c0-110.6,0-221.2,0-331.9
              c0-7,5.6-12.6,12.6-12.6c27.3,0,54.5,0,81.8,0c6.1,0.2,11.3,4.7,12.3,10.8c1.8,10.9,3.5,21.7,5.3,32.6c0.2,1.1,1.6,1.4,2.3,0.5
              c23.9-34.7,65.3-53.8,108.1-53.8C601.6,189.7,662,263.1,662,358.1z M199,212.4c0,110.7,0,221.3,0,331.9c0,6.9-5.7,12.6-12.6,12.6
              c-31.4,0-62.9,0-94.3,0c-7,0-12.6-5.6-12.6-12.6c0-110.7,0-221.3,0-331.9c0-7,5.6-12.6,12.6-12.6c31.4,0,62.9,0,94.3,0
              C193.4,199.8,199,205.4,199,212.4z M276,35c3,4.1,3.2,9.6,0.6,13.9c-29.1,48.1-81.3,77.3-137.4,77.3c-27.6,0-54.7-7.1-78.8-20.6
              C36.3,92.1,16.1,72.5,1.8,48.9c-2.6-4.3-2.4-9.8,0.6-13.9c7.2-9.9,14.5-19.9,21.8-29.9c4.1-5.7,12.3-6.9,17.9-2.5                                                                                                                               
              c27.7,21.7,61.8,33.6,97.1,33.6s69.4-11.9,97.2-33.6c5.6-4.4,13.7-3.3,17.9,2.5C261.5,15.1,268.8,25,276,35z"
            fill="#101820"
          ></path>
        </svg>
      </a>
    </nav>
    <div class="register-lojista-form__container">
      <div class="container container--narrow register-lojista-form">
        <div class="register-lojista__card">

          <div class="progress-bar__container">
            <div class="go-back__container">
              <button class="go-back__btn d-none"><i class="fas fa-angle-left"></i></button>
            </div>
            <div class="register-form__progress-bar">
              <div class="step step1-icon active-step">
                <div class="bullet">
                  <span>1</span>
                </div>
                <div class="check fas fa-check d-none"></div>
              </div>
              <div class="step step2-icon">
                <div class="bullet">
                  <span>2</span>
                </div>
                <div class="check fas fa-check d-none"></div>
              </div>
              <div class="step step3-icon">
                <div class="bullet">
                  <span>3</span>
                </div>
                <div class="check fas fa-check d-none"></div>
              </div>
            </div>
          </div>

          <main>
            <div class="step__container step1">
              <header class="page__header page__header--centered">
                <h1 class="page__title heading h1">Crie sua conta</h1>
    
                <span>
                  Informe seu CNPJ para ter acesso a mais de 1.200 marcas e descontos exclusivos
                </span>
              </header>

              <div class="form__container">
                <div class="form__group cnpj__container">
                  <div class="form__div">
                    <input class="form__input" type="tel" id="cnpj" name="cnpj" placeholder=" " autocomplete="off">
                    <label class="form__label" for="cnpj">CNPJ</label>
                    <div class='cnpj__spinner input__spinner spinner d-none'></div>
                  </div>
                  <span class="cnpj-error-msg error-msg"></span>
                </div>


                {% assign newMarketplaceRegisterUrl = "https://loja.inventa.shop/register" %}

                <div class="go-to-cnpj-form-link__container">
                  <a class="go-to-cnpj-form__link" href="{% if shop.metafields.new_marketplace.signup_enabled %}{{ newMarketplaceRegisterUrl }}{% else %}/pages/cadastro-cpf{% endif %}">Sou lojista sem CNPJ</a>
                </div>

                <button class="register-lojista-form__btn" disabled>
                  Continuar
                  <span><i class="fas fa-arrow-right"></i></span>
                </button>

                <span class="link__container">
                  Já tem cadastro?
                  <a href="/#modal-popup">Acesse sua conta</a>

                </span>
              </div>
            </div>

            <div class="step__container step2 d-none">
              <header class="page__header page__header--centered">
                <h1 class="page__title heading h1">Sobre você</h1>
    
                <span>
                  Dados de contato
                </span>
              </header>

              <div class="form__container">
                <div class="form__group first_name__container">
                  <div class="form__div">
                    <input class="form__input" type="text" id="first_name" name="first_name" placeholder=" " autocomplete="off">
                    <label class="form__label" for="first_name">Seu nome</label>
                  </div>
                  <span class="first_name-error-msg error-msg"></span>
                </div>

                <div class="form__group phone__container">
                  <div class="form__div">
                    <input class="form__input" type="tel" id="phone" name="phone" placeholder=" " autocomplete="off">
                    <label class="form__label" for="phone">Celular com WhatsApp</label>
                  </div>
                  <span class="phone-error-msg error-msg"></span>
                </div>

                <div class="form__group cpf__container">
                  <div class="form__div">
                    <input class="form__input" type="tel" id="cpf" name="cpf" placeholder=" " autocomplete="off">
                    <label class="form__label" for="cpf">Seu CPF</label>
                  </div>
                  <span class="cpf-error-msg error-msg"></span>
                </div>

                <button class="register-lojista-form__btn step2__btn--next" disabled>
                  Continuar
                  <span><i class="fas fa-arrow-right"></i></span>
                </button>

              </div>
            </div>

            <div class="step__container step3 d-none">
              <header class="page__header page__header--centered">
                <h1 class="page__title heading h1">Dados de acesso</h1>
    
                <span>
                  Você vai usar esses dados para acessar sua conta Inventa
                </span>
              </header>

              <div class="form__container">
                <div class="form__group email__container">
                  <div class="form__div">
                    <input class="form__input" type="email" id="email" name="email" placeholder=" " autocomplete="off">
                    <label class="form__label" for="email">E-mail corporativo</label>
                  </div>
                  <span class="email-error-msg error-msg"></span>
                </div>

                <div class="form__group password__container">
                  <div class="form__div">
                    <input class="form__input" type="password" id="password" name="password" placeholder=" " autocomplete="off">
                    <label class="form__label" for="password">Senha</label>
                    <i class="far fa-eye" id="togglePassword"></i>
                  </div>
                  <span class="cpf-error-msg error-msg">A senha deve ter no mínimo 8 dígitos</span>
                </div>

                <div class="form__group termos_e_condicoes__container cbox">
                  <div class="form__div">
                    <label>
                      <input class="termos_e_condicoes__input" type="checkbox" id="termos_e_condicoes" value="false">
                      Aceito os <a href="/pages/termos-e-condicoes-lojistas" target="_blank">Termos e condições</a>
                    </label>
                   
                  </div>
                  <span class="cpf-error-msg error-msg"></span>
                </div>

                <div class="form__group analise_de_credito__container cbox">
                  <div class="form__div">
                    <label>
                      <input class="analise_de_credito__input" type="checkbox" id="analise_de_credito" value="true" checked>
                      <span>Autorizo o uso dos meus dados para</span> <a href="https://cdn.shopify.com/s/files/1/0507/3226/9775/files/INVENTA_-_TERMO_DE_AUTORIZACAO_SCR_LGPD.pdf" target="_blank">Análise de crédito</a> segundo a Lei n° 13.709/2018 
                    </label>
                    
                  </div>
                  <span class="cpf-error-msg error-msg"></span>
                </div>

                <div class="form__group recebiveis_de_cartoes__container cbox">
                  <div class="form__div">
                    <label>
                      <input class="recebiveis_de_cartoes__input" type="checkbox" id="recebiveis_de_cartoes" value="true" checked>
                      Autorizo consultas referentes à <a href="https://cdn.shopify.com/s/files/1/0507/3226/9775/files/TEXTO_AUTORIZACAO_DE_CONSULTA_DE_AGENDA.pdf" target="_blank"> Recebíveis de cartões</a>
                    </label>
                    
                  </div>
                  <span class="cpf-error-msg error-msg"></span>
                </div>


                <button class="register-lojista-form__btn confirmar__btn" disabled>
                  Confirmar
                </button>

              </div>
            </div>

            <div class="register-form__container d-none">
              {% render "customer-fields", form_id: "70teD7" %}
            </div>
          </main>
        </div>
      </div>
    </div>  
    <script>
      const formId = '70teD7';
      const cnpjSpinner = document.querySelector('.cnpj__spinner');
      const divStep1 = document.querySelector('.step1');
      const step1Bullet = document.querySelector('.step1-icon');
      const cnpjInput = document.querySelector('#cnpj');
      const btnNextStep1 = document.querySelector('.register-lojista-form__btn');

      const divStep2 = document.querySelector('.step2');
      const step2Bullet = document.querySelector('.step2-icon');
      const btnGoBack = document.querySelector('.go-back__btn');
     
      const nameInput = document.querySelector('#first_name');
      const phoneInput = document.querySelector('#phone');
      const cpfInput = document.querySelector('#cpf');
      
      const step2IsValid = {
        first_name: false,
        phone: false,
        cpf: false,
      }
      const btnNextStep2 = document.querySelector('.step2__btn--next');
      
      const divStep3 = document.querySelector('.step3');
      const step3Bullet = document.querySelector('.step3-icon');
      const emailInput = document.querySelector('#email');
      const passwordInput = document.querySelector('#password');
      const termsAndConditionsCbox = document.querySelector('#termos_e_condicoes');
      const creditAnalysisCbox = document.querySelector('#analise_de_credito');
      const cardReceivablesCbox = document.querySelector('#recebiveis_de_cartoes');

      const step3IsValid = {
        email: false,
        password: false,
        termos_e_condicoes: false,
        analise_de_credito: true,
        recebiveis_de_cartoes: true,
      }

      const togglePassword = document.querySelector("#togglePassword");
      const btnConfirmar = document.querySelector('.confirmar__btn');

      let form;
      let currentStep = 0;
      let backendErrorPhone = false;
      let backendErrorEmail = false;

      window.addEventListener("cf:ready", function (event) {

        form = document.querySelector(`form[data-cf-form="${formId}"]`);

        function addFocusListener(elem) {
          elem.addEventListener('focus', function(){
            let inputContainer = document.querySelector(`.${elem.id}__container`);
            inputContainer.classList.remove('touched');
          });

          elem.addEventListener('blur', function() {
            let inputContainer = document.querySelector(`.${elem.id}__container`);
            inputContainer.classList.add('touched');
          });
        }

        var inputs = document.querySelectorAll('input');
        for(var i = 0; i < inputs.length; i++) {
          addFocusListener(inputs[i]);
        }
        
        cnpjInput.addEventListener('input', () => {
          cnpjInput.value = addCNPJMask(cnpjInput.value);
          form.cfForm.setFieldValue('cnpj',cnpjInput.value );
        })

        nameInput.addEventListener('input', () => {
          form.cfForm.setFieldValue('first_name',nameInput.value );
        })

        phoneInput.addEventListener('input', () => {
          if(backendErrorPhone){
            let inputContainer = document.querySelector(`.phone__container`);
            inputContainer.classList.remove('error', 'touched');
            backendErrorPhone = false;
          }
          validateNextStep2Btn()

          phoneInput.value = addPhoneMask(phoneInput.value);
          form.cfForm.setFieldValue('phone',phoneInput.value );
        });

        cpfInput.addEventListener('input', () => {
          cpfInput.value = addCPFMask(cpfInput.value)
          form.cfForm.setFieldValue('cpf',cpfInput.value );
        });

        emailInput.addEventListener('input', () => {
          if(backendErrorEmail){
            let inputContainer = document.querySelector(`.email__container`);
            inputContainer.classList.remove('error', 'touched');
            backendErrorEmail = false;
          }

          validateConfirmarBtn()
          form.cfForm.setFieldValue('email',emailInput.value );
        });

        passwordInput.addEventListener('input', () => {
          form.cfForm.setFieldValue('password',passwordInput.value );
        });

        togglePassword.addEventListener("click", function () {
            const type = passwordInput.getAttribute("type") === "password" ? "text" : "password";
            passwordInput.setAttribute("type", type);
 
            this.classList.toggle("fa-eye-slash");
        });

        termsAndConditionsCbox.addEventListener('input', () => {
          form.cfForm.setFieldValue('termos_e_condicoes', termsAndConditionsCbox.checked );
        });

        termsAndConditionsCbox.addEventListener('input', () => {
          form.cfForm.setFieldValue('termos_e_condicoes', termsAndConditionsCbox.checked );
        });

        termsAndConditionsCbox.addEventListener('input', () => {
          form.cfForm.setFieldValue('termos_e_condicoes', termsAndConditionsCbox.checked );
        });

        btnNextStep1.onclick = () => {
          form.cfForm.goToNextStep()
        }

        btnNextStep2.onclick = () => {
          form.cfForm.goToNextStep()
        }

        btnGoBack.onclick = () => {
          form.cfForm.goToPreviousStep()
        }

        btnConfirmar.onclick = () => {
          CF.customer.addTag("cnpj-user");

          let btnSubmit = document.querySelector('.cf-submit-form');
          btnSubmit.click();

          btnConfirmar.setAttribute('disabled','')
          btnConfirmar.innerHTML = `
          <div class="confirmar__btn--info">
              <div class="cnpj__spinner spinner"></div>
              <span>Salvando...</span>
          </div>
          `
        }

        form.addEventListener('cf:step_changed', function(event) {
          currentStep = event.detail.toIndex;

          if(currentStep === 0){
            changeToStep1()
          }

          if (currentStep === 1) {
            changeToStep2()
          }

          if (currentStep === 2) {
            changeToStep3()
          }

        });

        form.addEventListener('cf:field_validated', function(event) {
          var fieldId = event.detail.fieldId;
          var columnKey = event.detail.columnKey;
          var errors = event.detail.errors;

          let inputContainer = document.querySelector(`.${columnKey}__container`);
          let errorContainer = inputContainer.querySelector(`.error-msg`)

          if(currentStep === 0){
            if(errors.length > 0){
              inputContainer.classList.add('error');
              errorContainer.textContent = errors[0];
              btnNextStep1.setAttribute('disabled','');
            }
          }else if (currentStep === 1){
            if(errors.length > 0){
              inputContainer.classList.add('error');
              errorContainer.textContent = errors[0]
              
              step2IsValid[columnKey] = false

            }else{
              inputContainer.classList.remove('error');
              errorContainer.textContent = ''
              step2IsValid[columnKey] = true
            }

            validateNextStep2Btn()
          }else{
            if(errors.length > 0){
              inputContainer.classList.add('error');
              errorContainer.textContent = errors[0]
              
              step3IsValid[columnKey] = false

            }else{
              inputContainer.classList.remove('error');
              if(columnKey !== 'password'){
                errorContainer.textContent = ''
              }
              step3IsValid[columnKey] = true
            }

            validateConfirmarBtn()
          }

        });

        form.addEventListener('cf:form_submitted', function(event) {
          dataLayer.push({event: 'sign_up_success'});
          sessionStorage.setItem('user-platform-token', btoa(JSON.stringify([emailInput.value, passwordInput.value])));
        })

        form.addEventListener('cf:form_submission_failed', function(event) {
          sessionStorage.removeItem('user-platform-token');

          var errors = event.detail.errors;

          if(errors.email){
            let inputContainer = document.querySelector(`.email__container`);
            let errorContainer = inputContainer.querySelector(`.error-msg`);

            inputContainer.classList.add('error','touched');
            backendErrorEmail = true;

            if(errors.email[0] === 'has already been taken'){
              errorContainer.textContent = 'E-mail já cadastrado'
            }

            if(errors.email[0] === 'is invalid'){
              errorContainer.textContent = 'E-mail inválido'
            }
          }

          if(errors.phone){
            form.cfForm.goToStep(1);

            changeToStep2();

            let inputContainer = document.querySelector(`.phone__container`);
            let errorContainer = inputContainer.querySelector(`.error-msg`);

            inputContainer.classList.add('error','touched');
            backendErrorPhone = true;

            if(errors.phone[0] === 'has already been taken'){
              errorContainer.textContent = 'Número de telefone já cadastrado'
            }
            if(errors.phone[0] === 'is invalid'){
              errorContainer.textContent = 'Número de telefone inválido'
            }
          }
          
          btnConfirmar.innerHTML = 'Confirmar'
        });

      });

      function changeToStep1(){
        divStep1.classList.remove('d-none');
        divStep2.classList.add('d-none');
        btnGoBack.classList.add('d-none');
      }

      function changeToStep2(){
        let checkIcon = step1Bullet.querySelector('.check');
        checkIcon.classList.remove('d-none');
        step2Bullet.classList.add('active-step');
        divStep1.classList.add('d-none');
        divStep2.classList.remove('d-none');
        btnGoBack.classList.remove('d-none');
        step1Bullet.classList.add('step-completed');
        step3Bullet.classList.remove('active-step');
        step2Bullet.classList.remove('step-completed');

        let checkIconStep2 = step2Bullet.querySelector('.check');
        checkIconStep2.classList.add('d-none');
        divStep3.classList.add('d-none');
      }
      
      function changeToStep3(){
        let checkIcon = step2Bullet.querySelector('.check');
        checkIcon.classList.remove('d-none');
        step2Bullet.classList.add('step-completed');
        step3Bullet.classList.add('active-step');
        divStep2.classList.add('d-none');
        divStep3.classList.remove('d-none');
      }

      function validateConfirmarBtn(){
        if(step3IsValid.email & step3IsValid.password & step3IsValid.termos_e_condicoes){
              btnConfirmar.removeAttribute('disabled');
        }else{
              btnConfirmar.setAttribute('disabled', '');
        }
      }

      function validateNextStep2Btn() {
        if(step2IsValid.first_name & step2IsValid.phone & step2IsValid.cpf){
              btnNextStep2.removeAttribute('disabled');
            }else{
              btnNextStep2.setAttribute('disabled', '');
            }
      }

      function addCNPJMask(str) {
        var a = str.replace(/[^\d]+/g, ''); // remove non digit chars.
        return a.replace(/(\d{2})(\d)/, '$1.$2').replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d)/, '$1/$2').replace(/(\d{4})(\d{1,2})/, '$1-$2').replace(/(-\d{2})\d+?$/, '$1')
      }

      function addCPFMask(str) {
        var a = str.replace(/[^\d]+/g, ''); // remove non digit chars.
        return a.replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d)/, '$1.$2').replace(/(\d{3})(\d)/, '$1-$2').replace(/(-\d{2})\d+?$/, '$1')
      }

      function addPhoneMask(str) {
          if(str.includes('+55') | str.includes('+ 55')){
            let res = str.replace(/\D/g, '')
              .replace(/(\d{2})(\d)/, "$1 $2")
              .replace(/(\d{2})(\d)/, "$1 $2")
              .replace(/(\d{4})(\d)/, "$1-$2")
              .replace(/(\d{4})-(\d)(\d{4})/, "$1$2-$3")
              .replace(/(\d{4})\d+?$/, "$1")
              
            return `+${res}`;
          }else{
            if(str === '+5'){
              return '+55'
            }

            let res = str.replace(/\D/g, '')
            .replace(/(\d{2})(\d)/, "$1 $2")
            .replace(/(\d{4})(\d)/, "$1-$2")
            .replace(/(\d{4})-(\d)(\d{4})/, "$1$2-$3")
            .replace(/(\d{4})\d+?$/, "$1")
            
            return `+55 ${res}`;
          }
      
       
      }

    </script>

    <script>

      CF.ready(function() {
        dataLayer.push({ event: 'sign_up_step1' })

        var $form = document.querySelector(`form[data-cf-form="${formId}"]`);

        function cpfValidator(input) {
          const digitOnlyRegexp = /\D/g
          const cpf = input.replace(digitOnlyRegexp, '')
          const arr = Array.from(cpf)

          function digitValidator (cpfIndex) {

            const digitValidation = parseInt(arr[cpfIndex])

            const sum = arr.slice(0, cpfIndex).reduce((accumulated, current, arrIndex) => {
              accumulated = accumulated + parseInt(current) * ((cpfIndex + 1) - arrIndex)
              return accumulated
            }, 0)

            const calc = ((sum * 10) % 11)
            const result = calc === 10 ? 0 : calc
            return result === digitValidation

          }

          const isSameDigit = arr.every(element => arr[0] === element)
          if(isSameDigit) return false

          //first digit validation
          const firstDigitIsValid = digitValidator(9)
          if(!firstDigitIsValid) return false

          //second sigit validation
          return digitValidator(10)
        }


        const cpf_validator = {
          comparator: cpfValidator,
          errorMessage: 'CPF é inválido, favor validar os números informados',
          async: false
        }

        $form.cfForm.addValidator(cpf_validator, "cpf");

        const validation = {
          comparator: async (value) => {
            return new Promise((resolve, reject) => {
              const pageHost = {{ request.host | json }};
              cnpjSpinner.classList.remove('d-none');

              const corsUrl = "https://cors.inventashop.com.br/";
              let shopifyShopUrl = "https://inventa.shop";
              let shopifyApiUrl = "https://api.inventa.tec.br";
              let shopifyApiKey = "LmRkuO9OI9";
              let shopifyApiSecretKey = "42Ipvjz39M";

              if (pageHost.includes("dev")) {
                  shopifyShopUrl = "https://inventa-dev.myshopify.com";
                  shopifyApiUrl = "https://api.inventa.dev.br";
                  shopifyApiKey = "LMYzUdD0Wq";
                  shopifyApiSecretKey = "GHrI6Xg0Qc";
              }

              const cnpj = value.replace(/\D/g, '');
              const cnpj_url = `${corsUrl}${shopifyApiUrl}/data/shopify/retailer_data/${cnpj}`;

              fetch(cnpj_url, {
                method: 'GET',
                headers: {
                  'Content-Type': 'application/json',
                  'origin': 'shopify',
                  'api-key': shopifyApiKey,
                  'secret-key': shopifyApiSecretKey
                }
              }).then( async(res) => {
                let inputContainer = document.querySelector(`.cnpj__container`);
                inputContainer.classList.add('touched');
                cnpjSpinner.classList.add('d-none');
                btnNextStep1.setAttribute('disabled','');

                if(res.status == 403) {
                  resolve(false);
                  return {
                    message: "CNPJ já cadastrado."
                  };
                }


                inputContainer.classList.remove('error');

                let errorContainer = inputContainer.querySelector(`.error-msg`);
                errorContainer.textContent = '';

                btnNextStep1.removeAttribute('disabled');


                res.json()
              })
              .then(res => {
                if(res && res.message == "CNPJ já cadastrado.") resolve(false);
                else resolve(true);
              });

            });

          },
          errorMessage: 'O CNPJ já foi utilizado',
          async: true,
        };

        $form.cfForm.addValidator(validation, "cnpj");

      });
    </script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/js/fontawesome.min.js" defer></script>
  </body>
</html>
